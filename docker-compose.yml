version: '3.8'

services:
  tor-proxy:
    build: .
    image: ghcr.io/eslutz/torarr:latest
    container_name: tor-proxy
    environment:
      - TZ=${TZ:-America/New_York}
      - TOR_CONTROL_PASSWORD=${TOR_CONTROL_PASSWORD:-}
      - HEALTH_PORT=8080
      - LOG_LEVEL=INFO
    ports:
      - "127.0.0.1:9050:9050"  # SOCKS5 proxy
      - "127.0.0.1:8080:8080"  # Health endpoint (optional)
    volumes:
      - tor-data:/var/lib/tor  # Consensus cache for fast restarts
    restart: unless-stopped
    networks:
      - torrent-services-network
    healthcheck:
      test: ["CMD", "wget", "-qO-", "--timeout=5", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Example: Prowlarr using Tor proxy
  # prowlarr:
  #   image: lscr.io/linuxserver/prowlarr:latest
  #   container_name: prowlarr
  #   environment:
  #     - PUID=1000
  #     - PGID=1000
  #     - TZ=${TZ:-America/New_York}
  #   volumes:
  #     - ./prowlarr:/config
  #   ports:
  #     - "9696:9696"
  #   restart: unless-stopped
  #   networks:
  #     - torrent-services-network
  #   depends_on:
  #     tor-proxy:
  #       condition: service_healthy

networks:
  torrent-services-network:
    driver: bridge

volumes:
  tor-data:
    driver: local
