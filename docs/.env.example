# ==========================================
# Torarr Configuration
# ==========================================
# This file contains all available configuration options for Torarr.
# Copy this file to .env and uncomment/modify values as needed.
#
# Configuration is loaded from environment variables only.
# Defaults are shown for each setting.
# ==========================================

# ==========================================
# GENERAL CONFIGURATION
# ==========================================

# ------------------------------------------
# Container Timezone
# ------------------------------------------
# Sets the timezone for the container and log timestamps.
# Use standard IANA timezone names (e.g., America/New_York, Europe/London).
# Default: UTC
# ------------------------------------------
TZ=UTC

# ------------------------------------------
# Logging Level
# ------------------------------------------
# Controls the verbosity of application logs.
# Options: DEBUG, INFO, WARN, ERROR
# - DEBUG: Verbose output including internal details (use for troubleshooting)
# - INFO: Standard operational messages
# - WARN: Warning messages for potential issues
# - ERROR: Only error messages
# Default: INFO
# ------------------------------------------
LOG_LEVEL=INFO

# ==========================================
# TOR CONFIGURATION
# ==========================================

# ------------------------------------------
# Tor Control Port Address
# ------------------------------------------
# Address and port where the health server connects to Tor's control port.
# Should match the ControlPort setting in torrc.
# Format: host:port
# Default: 127.0.0.1:9051
# ------------------------------------------
TOR_CONTROL_ADDRESS=127.0.0.1:9051

# ------------------------------------------
# Tor Control Password
# ------------------------------------------
# Password for authenticating with Tor's control port.
# If not set, a random password is auto-generated at container startup.
# The entrypoint script will hash this value and update torrc.
#
# Security note: If using a custom password, ensure container logs are secured
# as the password may appear during startup.
# Default: (auto-generated if unset)
# ------------------------------------------
# TOR_CONTROL_PASSWORD=my_secure_password

# ------------------------------------------
# Exit Nodes
# ------------------------------------------
# Restrict which Tor exit nodes are used for outbound connections.
# Useful for:
# - Geolocation requirements (e.g., only US/CA exits for regional content)
# - Avoiding certain jurisdictions
# - Testing with consistent exit locations
#
# Format: Comma-separated list of:
# - Country codes in curly braces: {us},{ca},{de}
# - Specific node fingerprints: $FINGERPRINT (find at https://metrics.torproject.org/rs.html)
# - Mixed: {us},$FINGERPRINT,{ca}
#
# Examples:
# TOR_EXIT_NODES={us}                    # US exits only
# TOR_EXIT_NODES={us},{ca}               # US or Canadian exits
# TOR_EXIT_NODES={us},{ca},{de}          # Multiple countries
# TOR_EXIT_NODES=$ABCD1234...            # Specific node fingerprint
#
# Warning: Restricting exit nodes may:
# - Reduce anonymity by limiting the exit node pool
# - Cause slower connections if few nodes match criteria
# - Fail if no matching nodes are available
#
# Default: (none - use any available exit node)
# ------------------------------------------
# TOR_EXIT_NODES={us},{ca}

# ==========================================
# HEALTH SERVER CONFIGURATION
# ==========================================

# ------------------------------------------
# Health Server Port
# ------------------------------------------
# Port where the health/metrics HTTP server listens.
# Endpoints:
# - GET /ping       - Liveness probe
# - GET /health     - Readiness probe (Tor bootstrap check)
# - GET /ready      - Readiness with external Tor egress verification
# - GET /status     - Diagnostics snapshot
# - GET /metrics    - Prometheus metrics
# - POST /renew     - Request new Tor circuit (NEWNYM)
# Default: 9091
# ------------------------------------------
HEALTH_PORT=9091

# ------------------------------------------
# External Check Timeout
# ------------------------------------------
# Timeout in seconds for external Tor egress verification requests.
# Used by the /ready endpoint when checking connectivity through Tor.
# Increase if you experience frequent timeout failures.
# Default: 15
# ------------------------------------------
HEALTH_EXTERNAL_TIMEOUT=15

# ------------------------------------------
# External Check Endpoints
# ------------------------------------------
# Comma-separated list of external URLs used to verify Tor connectivity.
# The /ready endpoint will attempt requests to these URLs through the SOCKS proxy.
#
# Requirements:
# - Must be reachable over Tor
# - Should respond with Tor detection info (e.g., "IsTor": true)
#
# Recommended endpoints:
# - https://check.torproject.org/api/ip - Official Tor Project check (default)
# - https://check.dan.me.uk/ - Alternative Tor check
# - https://ipinfo.io/json - IP info including detected country
#
# Multiple endpoints increase reliability but add latency to /ready checks.
# Default: https://check.torproject.org/api/ip
# ------------------------------------------
HEALTH_EXTERNAL_ENDPOINTS=https://check.torproject.org/api/ip,https://check.dan.me.uk/,https://ipinfo.io/json

# ==========================================
# WEBHOOK NOTIFICATIONS
# ==========================================
# Torarr can send webhook notifications for various events.
# Useful for monitoring circuit renewals, bootstrap failures, and health changes.

# ------------------------------------------
# Webhook URL
# ------------------------------------------
# The webhook endpoint URL where notifications will be sent.
# If not set, webhook notifications are disabled.
#
# Supported services:
# - Discord: https://discord.com/api/webhooks/YOUR_WEBHOOK_ID/YOUR_WEBHOOK_TOKEN
# - Slack: https://hooks.slack.com/services/YOUR/WEBHOOK/PATH
# - Gotify: https://gotify.example.com/message?token=YOUR_TOKEN
# - Custom: Any endpoint accepting JSON POST requests
#
# Default: (none - notifications disabled)
# ------------------------------------------
# WEBHOOK_URL=https://discord.com/api/webhooks/123456789/abcdefghijklmnop

# ------------------------------------------
# Webhook Template
# ------------------------------------------
# Format/template for webhook payloads.
# Options:
# - discord: Discord-compatible embeds with color-coded events
# - slack: Slack attachments with formatted fields
# - gotify: Gotify priority-based notifications
# - json: Plain JSON payloads for custom integrations
#
# Choose the template matching your webhook receiver.
# Default: discord
# ------------------------------------------
# WEBHOOK_TEMPLATE=discord

# ------------------------------------------
# Webhook Events
# ------------------------------------------
# Comma-separated list of events to trigger webhook notifications.
# Available events:
# - circuit_renewed: Sent when POST /renew successfully requests a new circuit
# - bootstrap_failed: Tor bootstrap is below 100% (checked on every /health call)
# - health_changed: Health status transitioned (healthy <-> unhealthy)
#
# Notes:
# - bootstrap_failed fires on EVERY health check while unhealthy.
#   In Kubernetes with frequent probes, this can generate many notifications.
#   Consider using health_changed instead for state transition alerts.
# - health_changed only fires once per state transition (reduces noise).
# - Multiple events: WEBHOOK_EVENTS=circuit_renewed,health_changed
#
# Default: circuit_renewed,bootstrap_failed,health_changed
# ------------------------------------------
# WEBHOOK_EVENTS=circuit_renewed,health_changed

# ------------------------------------------
# Webhook Timeout
# ------------------------------------------
# Timeout for webhook HTTP requests.
# Supports Go duration format: 10s, 30s, 1m, etc.
#
# If the webhook receiver is slow or unreliable, increase this value.
# However, longer timeouts may delay health checks or circuit renewals.
# Default: 10s
# ------------------------------------------
# WEBHOOK_TIMEOUT=10s

# ==========================================
# ADVANCED CONFIGURATION
# ==========================================
# Most users won't need to modify these settings.
# The defaults are suitable for typical deployments.

# ------------------------------------------
# Custom Tor Configuration (torrc)
# ------------------------------------------
# For advanced Tor settings not exposed as environment variables,
# you can mount a custom torrc file into the container.
#
# Requirements:
# - Must be mounted as WRITABLE (entrypoint modifies it at startup)
# - Should include: ControlPort, SocksPort, DataDirectory
# - HashedControlPassword will be auto-generated and written by entrypoint
#
# Example docker-compose volume:
# volumes:
#   - ./custom-torrc:/etc/tor/torrc:rw
#   - tor-data:/var/lib/tor
# ------------------------------------------
